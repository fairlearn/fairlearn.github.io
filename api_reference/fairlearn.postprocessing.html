

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fairlearn.postprocessing package &#8212; Fairlearn 0.4.7.dev0 documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"E": "{\\mathbb{E}}", "P": "{\\mathbb{P}}", "given": "\\mathbin{\\vert}"}}})</script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="fairlearn.reductions package" href="fairlearn.reductions.html" />
    <link rel="prev" title="fairlearn.metrics package" href="fairlearn.metrics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../contents.html">
      <img src="../_static/fairlearn_full_color.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../about/index.html">About</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../quickstart.html">Quickstart</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../user_guide/index.html">User Guide</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">API Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../auto_examples/notebooks/index.html">Example Notebooks</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../contributor_guide/index.html">Contributor Guide</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../faq.html">FAQ</a>
        </li>
        
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://gitter.im/fairlearn/community">Gitter<i class="fas fa-external-link-alt"></i></a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://stackoverflow.com/questions/tagged/fairlearn">StackOverflow<i class="fas fa-external-link-alt"></i></a>
        </li>
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/fairlearn/fairlearn" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
        
          
              <li class="">
                  <a href="fairlearn.datasets.html">fairlearn.datasets package</a>
              </li>
          
        
          
              <li class="">
                  <a href="fairlearn.metrics.html">fairlearn.metrics package</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">fairlearn.postprocessing package</a>
              </li>
          
        
          
              <li class="">
                  <a href="fairlearn.reductions.html">fairlearn.reductions package</a>
              </li>
          
        
          
              <li class="">
                  <a href="fairlearn.widget.html">fairlearn.widget package</a>
              </li>
          
        
          
              <li class="">
                  <a href="fairlearn.datasets.html">fairlearn.datasets package</a>
              </li>
          
        
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="module-fairlearn.postprocessing">
<span id="fairlearn-postprocessing-package"></span><h1>fairlearn.postprocessing package<a class="headerlink" href="#module-fairlearn.postprocessing" title="Permalink to this headline">¶</a></h1>
<p>This module contains methods which operate on a predictor, rather than an estimator.</p>
<p>The predictor’s output is adjusted to fulfill specified parity constraints. The postprocessors
learn how to adjust the predictor’s output from the training data.</p>
<dl class="py class">
<dt id="fairlearn.postprocessing.ThresholdOptimizer">
<em class="property">class </em><code class="sig-prename descclassname">fairlearn.postprocessing.</code><code class="sig-name descname">ThresholdOptimizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">estimator</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">constraints</span><span class="o">=</span><span class="default_value">'demographic_parity'</span></em>, <em class="sig-param"><span class="n">objective</span><span class="o">=</span><span class="default_value">'accuracy_score'</span></em>, <em class="sig-param"><span class="n">grid_size</span><span class="o">=</span><span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">flip</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">prefit</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference external" href="http://github.com/fairlearn/fairlearn/blob/master/fairlearn/postprocessing/_threshold_optimizer.py#L93-L441"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fairlearn.postprocessing.ThresholdOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="(in scikit-learn v0.23)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.BaseEstimator</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.MetaEstimatorMixin</span></code></p>
<p>A classifier based on the threshold optimization approach.</p>
<p>The classifier is obtained by applying group-specific thresholds to
the provided estimator. The thresholds are chosen to optimize the
provided performance objective subject to the provided fairness constraints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>estimator</strong> (<em>estimator object implementing 'predict' and possibly 'fit'</em>) – An estimator whose output is postprocessed.</p></li>
<li><p><strong>constraints</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>default='demographic_parity'</em>) – <p>Fairness constraints under which threshold optimization is performed.
Possible inputs are:</p>
<blockquote>
<div><dl class="simple">
<dt>’demographic_parity’, ‘selection_rate_parity’ (synonymous)</dt><dd><p>match the selection rate across groups</p>
</dd>
<dt>’{false,true}_{positive,negative}_rate_parity’</dt><dd><p>match the named metric across groups</p>
</dd>
<dt>’equalized_odds’</dt><dd><p>match true positive and false positive rates across groups</p>
</dd>
</dl>
</div></blockquote>
</p></li>
<li><p><strong>objective</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>default='accuracy_score'</em>) – <p>Performance objective under which threshold optimization is performed.
Not all objectives are allowed for all types of constraints.
Possible inputs are:</p>
<blockquote>
<div><dl class="simple">
<dt>’accuracy_score’, ‘balanced_accuracy_score’</dt><dd><p>allowed for all constraint types</p>
</dd>
<dt>’selection_rate’, ‘true_positive_rate’, ‘true_negative_rate’,</dt><dd><p>allowed for all constraint types except ‘equalized_odds’</p>
</dd>
</dl>
</div></blockquote>
</p></li>
<li><p><strong>grid_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>default=1000</em>) – The values of the constraint metric are discretized according to the grid
of the specified size over the interval [0,1] and the optimization is
performed with respect to the constraints achieving those values. In case
of ‘equalized_odds’ the constraint metric is the false positive rate.</p></li>
<li><p><strong>flip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>default=False</em>) – If True, then allow flipping the decision if it improves the resulting</p></li>
<li><p><strong>prefit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>default=False</em>) – If True, avoid refitting the given estimator. Note that when used
with <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="(in scikit-learn v0.23)"><code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.model_selection.cross_val_score()</span></code></a>,
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html#sklearn.model_selection.GridSearchCV" title="(in scikit-learn v0.23)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.model_selection.GridSearchCV</span></code></a>, this will result in an error.
In that case, please use <code class="docutils literal notranslate"><span class="pre">prefit=False</span></code>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The procedure is based on the algorithm of
<a class="reference external" href="https://arxiv.org/abs/1610.02413">Hardt et al. (2016)</a>.</p>
<dl class="py method">
<dt id="fairlearn.postprocessing.ThresholdOptimizer.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">sensitive_features</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference external" href="http://github.com/fairlearn/fairlearn/blob/master/fairlearn/postprocessing/_threshold_optimizer.py#L160-L221"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fairlearn.postprocessing.ThresholdOptimizer.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the model.</p>
<p>The fit is based on training features and labels, sensitive features,
as well as the fairness-unaware predictor or estimator. If an estimator was passed
in the constructor this fit method will call <cite>fit(X, y, **kwargs)</cite> on said estimator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>numpy.ndarray</em><em> or </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.1.0)"><em>pandas.DataFrame</em></a>) – The feature matrix</p></li>
<li><p><strong>y</strong> (<em>numpy.ndarray</em><em>, </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.1.0)"><em>pandas.DataFrame</em></a><em>, </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="(in pandas v1.1.0)"><em>pandas.Series</em></a><em>, or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – The label vector</p></li>
<li><p><strong>sensitive_features</strong> (<em>currently 1D array as numpy.ndarray</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>, </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.1.0)"><em>pandas.DataFrame</em></a><em>,
or </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="(in pandas v1.1.0)"><em>pandas.Series</em></a>) – sensitive features to identify groups by, currently allows
only a single column</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="fairlearn.postprocessing.ThresholdOptimizer.predict">
<code class="sig-name descname">predict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">sensitive_features</span></em>, <em class="sig-param"><span class="n">random_state</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference external" href="http://github.com/fairlearn/fairlearn/blob/master/fairlearn/postprocessing/_threshold_optimizer.py#L223-L238"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fairlearn.postprocessing.ThresholdOptimizer.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Predict label for each sample in X while taking into account sensitive features.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>numpy.ndarray</em><em> or </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.1.0)"><em>pandas.DataFrame</em></a>) – feature matrix</p></li>
<li><p><strong>sensitive_features</strong> (<em>currently 1D array as numpy.ndarray</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>, </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.1.0)"><em>pandas.DataFrame</em></a><em>,
or </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="(in pandas v1.1.0)"><em>pandas.Series</em></a>) – sensitive features to identify groups by, currently allows
only a single column</p></li>
<li><p><strong>random_state</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – set to a constant for reproducibility</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>predictions in numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="fairlearn.postprocessing.plot_threshold_optimizer">
<code class="sig-prename descclassname">fairlearn.postprocessing.</code><code class="sig-name descname">plot_threshold_optimizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">threshold_optimizer</span></em>, <em class="sig-param"><span class="n">ax</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">show_plot</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference external" href="http://github.com/fairlearn/fairlearn/blob/master/fairlearn/postprocessing/_plotting.py#L64-L106"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fairlearn.postprocessing.plot_threshold_optimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the chosen solution of the threshold optimizer.</p>
<p>For <cite>fairlearn.postprocessing.ThresholdOptimizer</cite> objects that have their
constraint set to <cite>‘demographic_parity’</cite> this will result in a
selection/error curve plot. For <cite>fairlearn.postprocessing.ThresholdOptimizer</cite>
objects that have their constraint set to <cite>‘equalized_odds’</cite> this will
result in a ROC curve plot.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>threshold_optimizer</strong> (<a class="reference internal" href="#fairlearn.postprocessing.ThresholdOptimizer" title="fairlearn.postprocessing.ThresholdOptimizer"><em>fairlearn.postprocessing.ThresholdOptimizer</em></a>) – the <cite>ThresholdOptimizer</cite> instance for which the
results should be illustrated.</p></li>
<li><p><strong>ax</strong> (<cite>matplotlib.axes.Axes</cite>) – a custom <cite>matplotlib.axes.Axes</cite> object to use for the plots, default None</p></li>
<li><p><strong>show_plot</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – whether or not the generated plot should be shown, default True</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>


              </div>
              
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2019, Microsoft Corporation and contributors..<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>